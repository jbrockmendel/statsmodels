# -*- coding: utf-8 -*-
"""

Created on Sat Dec 24 07:31:47 2011

Author: Josef Perktold
"""

from __future__ import print_function
import numpy as np
import statsmodels.sandbox.stats.diagnostic as dia

canada = np.array([
    [405.36646643, 929.61051389,   7.53,       386.13610906],
    [404.63983397, 929.80398455,   7.7,        388.13575911],
    [403.81488304, 930.31838757,   7.47,       390.54011291],
    [404.21577319, 931.42768742,   7.27,       393.96381725],
    [405.04671359, 932.66200559,   7.37,       396.76469092],
    [404.41673867, 933.55093973,   7.13,       400.02170162],
    [402.81912737, 933.53152619,   7.4,        400.75149869],
    [401.97733466, 933.07687944,   8.33,       405.73347366],
    [402.08972495, 932.12375321,   8.83,       409.05038628],
    [401.30668837, 930.63593914,  10.43,       411.39837775],
    [401.63017126, 929.09705993,  12.2,        413.01942151],
    [401.56375463, 928.5633356,   12.77,       415.16696288],
    [402.81569891, 929.06938006,  12.43,       414.66207068],
    [403.14210762, 930.2655161,   12.23,       415.73193614],
    [403.07861917, 931.67703156,  11.7,        416.23146887],
    [403.71878573, 932.13896758,  11.2,        418.14392691],
    [404.86679903, 932.27668647,  11.27,       419.73523123],
    [405.63618674, 932.83278312,  11.47,       420.48418620],
    [405.13628538, 933.73341912,  11.3,        420.93088140],
    [406.02463992, 934.17720618,  11.17,       422.11240453],
    [406.41226973, 934.59283983,  11.,         423.62780581],
    [406.30093264, 935.60670983,  10.63,       423.98868675],
    [406.33535172, 936.51108597,  10.27,       424.19021266],
    [406.77369533, 937.42009011,  10.2,        426.12704335],
    [405.15254765, 938.41592163,   9.67,       426.85779422],
    [404.92983081, 938.99917002,   9.6,        426.74571799],
    [404.57654635, 939.23535479,   9.6,        426.88579366],
    [404.19949263, 939.67950423,   9.5,        428.84025326],
    [405.9498562,  940.24967414,   9.5,        430.12232211],
    [405.82209203, 941.43581869,   9.03,       430.23067915],
    [406.44628254, 942.29809598,   8.7,        430.39299489],
    [407.05124753, 943.53222326,   8.13,       432.02842008],
    [407.94602399, 944.34896982,   7.87,       433.38862593],
    [408.17958466, 944.82148879,   7.67,       433.96409182],
    [408.59981274, 945.06713693,   7.8,        434.48438435],
    [409.09056066, 945.80672616,   7.73,       436.15687928],
    [408.70421514, 946.8696615,    7.57,       438.26514394],
    [408.98027521, 946.87661214,   7.57,       438.76358734],
    [408.32869004, 947.24969226,   7.33,       439.94981156],
    [407.88569656, 947.65127609,   7.57,       441.83585639],
    [407.26053223, 948.18397074,   7.63,       443.17687266],
    [406.77515077, 948.34923926,   7.6,        444.35919903],
    [406.17941359, 948.03217066,   8.17,       444.52361481],
    [405.43979335, 947.10648312,   9.2,        446.96940464],
    [403.27997079, 946.07955423,  10.17,       450.15858697],
    [403.364856,   946.18381168,  10.33,       451.54642729],
    [403.38068043, 946.22579517,  10.4,        452.29835150],
    [404.00318281, 945.99778394,  10.37,       453.12006658],
    [404.47739842, 945.51827908,  10.6,        453.99914600],
    [404.78678276, 945.35139757,  11.,         454.95517622],
    [405.27100392, 945.29178552,  11.4,        455.48238116],
    [405.38299314, 945.4007859,   11.73,       456.10092902],
    [405.15641601, 945.90580984,  11.07,       457.20269674],
    [406.47004309, 945.90347041,  11.67,       457.38858959],
    [406.22930897, 946.31902875,  11.47,       457.77989892],
    [406.72648385, 946.57962128,  11.3,        457.55353809],
    [408.57850488, 946.78003222,  10.97,       458.80240272],
    [409.67671011, 947.62828424,  10.63,       459.05640336],
    [410.3857633,  948.62205755,  10.1,        459.15782325],
    [410.53952368, 949.39918324,   9.67,       459.70372028],
    [410.4452583,  949.94813797,   9.53,       459.70372028],
    [410.62560527, 949.79449414,   9.47,       460.02581416],
    [410.86723971, 949.95338018,   9.5,        461.02572250],
    [411.23591783, 950.25023944,   9.27,       461.30391444],
    [410.66365529, 950.53803088,   9.5,        461.40308144],
    [410.80850841, 950.7871285,    9.43,       462.92772613],
    [412.11596152, 950.86952865,   9.7,        464.68877793],
    [412.99940713, 950.92813247,   9.9,        465.07170009],
    [412.95505676, 951.84572248,   9.43,       464.28512530],
    [412.82413309, 952.6004762,    9.3,        464.03442610],
    [413.0488749,  953.59755276,   8.87,       463.45347946],
    [413.61101788, 954.14338834,   8.77,       465.07170009],
    [413.60478192, 954.54259333,   8.6,        466.08886747],
    [412.96838823, 955.26313611,   8.33,       466.61712075],
    [412.26588653, 956.05605285,   8.17,       465.74779656],
    [412.9105941,  956.7965864,    8.03,       465.89952727],
    [413.82941642, 957.38648045,   7.9,        466.40992535],
    [414.2241521,  958.06341571,   7.87,       466.95524449],
    [415.1677708,  958.71659219,   7.53,       467.62808134],
    [415.70158023, 959.48814242,   6.93,       467.70256231],
    [416.86740711, 960.36249308,   6.8,        469.13478822],
    [417.61039906, 960.78337904,   6.7,        469.33641967],
    [418.00298048, 961.02902994,   6.93,       470.01166633],
    [417.26668018, 961.76570981,   6.87,       469.64723444]])


template = (
    "        ARCH LM-test; Null hypothesis: no ARCH effects\n\n"
    "Chi-squared = %(chi)-8.4f df = %(df)-4d p-value = %(pval)8.4g\n"
)


def run_het_arch(colnum, maxlag):
    data = canada[:, colnum]
    res = dia.acorr_lm(data**2, maxlag=maxlag,
                       autolag=None, store=1)
    #
    print(template % dict(chi=res[0],
                          df=res[-1].resols.df_model,
                          pval=res[1]))


# R:FinTS: ArchTest(as.vector(Canada[,2]), lag=5)
"""
> ArchTest(as.vector(Canada[,2]), lag=5)

    ARCH LM-test; Null hypothesis: no ARCH effects

data:  as.vector(Canada[, 2])
Chi-squared = 78.8493, df = 5, p-value = 1.4606e-15
"""

run_het_arch(1, 5)
"""
>>> run_het_arch(1, 5)
        ARCH LM-test; Null hypothesis: no ARCH effects

Chi-squared = 78.8493  df = 5    p-value = 1.461e-15
"""

# R:FinTS: ArchTest(as.vector(Canada[,3]), lag=5)
"""
> ArchTest(as.vector(Canada[,3]), lag=5)

    ARCH LM-test; Null hypothesis: no ARCH effects

data:  as.vector(Canada[, 3])
Chi-squared = 74.6028, df = 5, p-value = 1.1259e-14
"""

run_het_arch(2, 5)
"""
>>> run_het_arch(2, 5)
        ARCH LM-test; Null hypothesis: no ARCH effects

Chi-squared = 74.6028  df = 5    p-value = 1.126e-14
"""

# R:FinTS: ArchTest(as.vector(Canada[,3]), lag=12)
"""
> ArchTest(as.vector(Canada[,3]), lag=12)
    ARCH LM-test; Null hypothesis: no ARCH effects

data:  as.vector(Canada[, 3])
Chi-squared = 69.6359, df = 12, p-value = 3.7468e-10
"""

run_het_arch(2, 12)
"""
>>> run_het_arch(2, 12)
        ARCH LM-test; Null hypothesis: no ARCH effects

Chi-squared = 69.6359  df = 12   p-value = 3.747e-10
"""
